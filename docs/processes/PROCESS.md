# ğŸ”„ Softsoul API í”„ë¡œì„¸ìŠ¤ ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
- [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
- [ì•„í‚¤í…ì²˜ íë¦„](#ì•„í‚¤í…ì²˜-íë¦„)
- [ìš”ì²­ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤](#ìš”ì²­-ì²˜ë¦¬-í”„ë¡œì„¸ìŠ¤)
- [ë°ì´í„° íë¦„](#ë°ì´í„°-íë¦„)
- [ì„œë²„ ì‹œì‘ í”„ë¡œì„¸ìŠ¤](#ì„œë²„-ì‹œì‘-í”„ë¡œì„¸ìŠ¤)
- [ì—ëŸ¬ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤](#ì—ëŸ¬-ì²˜ë¦¬-í”„ë¡œì„¸ìŠ¤)

---

## ğŸ¯ ì‹œìŠ¤í…œ ê°œìš”

**Softsoul API**ëŠ” Notionì˜ 11ê°œ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í†µí•© ê´€ë¦¬í•˜ëŠ” Express ê¸°ë°˜ RESTful API ì„œë²„ì…ë‹ˆë‹¤.

### í•µì‹¬ íŠ¹ì§•
- **í†µì¼ëœ API íŒ¨í„´**: ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ê°€ ë™ì¼í•œ CRUD íŒ¨í„´ ì‚¬ìš©
- **Generic Service íŒ¨í„´**: ì¬ì‚¬ìš© ê°€ëŠ¥í•œ ì„œë¹„ìŠ¤ ë ˆì´ì–´
- **ê°„í¸ ëª¨ë“œ & ì „ë¬¸ ëª¨ë“œ**: ì‚¬ìš©ì í¸ì˜ì„±ì„ ìœ„í•œ ë‘ ê°€ì§€ ëª¨ë“œ ì§€ì›
- **Properties ì „ìš© API**: í•„ë“œ ë‹¨ìœ„ ì¡°íšŒ/ìˆ˜ì • ì§€ì›

---

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Client    â”‚
â”‚  (Browser/  â”‚
â”‚   App)      â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚ HTTP Request
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Express Server               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      app.js (Middleware)     â”‚   â”‚
â”‚  â”‚  - CORS                      â”‚   â”‚
â”‚  â”‚  - JSON Parser               â”‚   â”‚
â”‚  â”‚  - Morgan (Logging)          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      Routes Layer            â”‚   â”‚
â”‚  â”‚  - /api/products             â”‚   â”‚
â”‚  â”‚  - /api/customers            â”‚   â”‚
â”‚  â”‚  - /api/warehouses           â”‚   â”‚
â”‚  â”‚  - ... (11ê°œ ë¼ìš°í„°)         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Generic Service Layer           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   createNotionService()       â”‚   â”‚
â”‚  â”‚  - getAllItems()              â”‚   â”‚
â”‚  â”‚  - getItem()                  â”‚   â”‚
â”‚  â”‚  - addItem()                  â”‚   â”‚
â”‚  â”‚  - updateItem()               â”‚   â”‚
â”‚  â”‚  - deleteItem()               â”‚   â”‚
â”‚  â”‚  - analyzeSchema()            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Notion Client Config            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   notionClient.js             â”‚   â”‚
â”‚  â”‚  - @notionhq/client           â”‚   â”‚
â”‚  â”‚  - DATABASE_IDS               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Notion API                   â”‚
â”‚  (External Service)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ ìš”ì²­ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤

### 1. ì „ì²´ ëª©ë¡ ì¡°íšŒ (POST /api/{endpoint}/list)

```
1. í´ë¼ì´ì–¸íŠ¸ ìš”ì²­
   POST /api/customers/list
   Body: { filter: {}, sorts: [], simplified: true }

2. Express ë¼ìš°í„° (src/routes/customers.js)
   â”œâ”€ ìš”ì²­ íŒŒë¼ë¯¸í„° íŒŒì‹±
   â”œâ”€ filter, sorts, simplified ì¶”ì¶œ
   â””â”€ Service í˜¸ì¶œ

3. Generic Service (src/services/genericService.js)
   â”œâ”€ getAllItems(filters, sorts) í˜¸ì¶œ
   â”œâ”€ Notion API ì¿¼ë¦¬ êµ¬ì„±
   â”‚  â””â”€ database_id, filter, sorts ì„¤ì •
   â””â”€ notion.databases.query() ì‹¤í–‰

4. Notion API
   â”œâ”€ ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ
   â””â”€ ê²°ê³¼ ë°˜í™˜ (results, has_more, next_cursor)

5. ì‘ë‹µ ë³€í™˜
   â”œâ”€ simplified=trueì¸ ê²½ìš°
   â”‚  â””â”€ simplifyProperties()ë¡œ ê°„ë‹¨í•œ í˜•íƒœë¡œ ë³€í™˜
   â””â”€ simplified=falseì¸ ê²½ìš°
      â””â”€ ì›ë³¸ Notion í˜•ì‹ ìœ ì§€

6. í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ
   {
     success: true,
     data: [...],
     count: 10,
     hasMore: false
   }
```

### 2. í•­ëª© ì¶”ê°€ (POST /api/{endpoint})

```
1. í´ë¼ì´ì–¸íŠ¸ ìš”ì²­
   POST /api/customers
   Body: { properties: { ... } }

2. Express ë¼ìš°í„°
   â”œâ”€ properties ê²€ì¦ (ì„ íƒì‚¬í•­)
   â””â”€ Service í˜¸ì¶œ

3. Generic Service
   â”œâ”€ addItem(properties) í˜¸ì¶œ
   â””â”€ notion.pages.create() ì‹¤í–‰
      â””â”€ parent: { database_id }, properties

4. Notion API
   â”œâ”€ ìƒˆ í˜ì´ì§€ ìƒì„±
   â””â”€ ìƒì„±ëœ í˜ì´ì§€ ë°˜í™˜

5. í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ
   {
     success: true,
     data: { ... }
   }
```

### 3. Properties ì—…ë°ì´íŠ¸ (PATCH /api/{endpoint}/:pageId/properties)

```
1. í´ë¼ì´ì–¸íŠ¸ ìš”ì²­
   PATCH /api/customers/í˜ì´ì§€ID/properties
   Body: {
     updates: {
       "ì´ë¦„": { type: "rich_text", value: "í™ê¸¸ë™" },
       "ë‚˜ì´": { type: "number", value: 30 }
     }
   }

2. Express ë¼ìš°í„°
   â”œâ”€ updates ê°ì²´ íŒŒì‹±
   â”œâ”€ Notion í˜•ì‹ìœ¼ë¡œ ë³€í™˜
   â”‚  â””â”€ convertToNotionFormat()
   â””â”€ Service í˜¸ì¶œ

3. Generic Service
   â””â”€ updateItem(pageId, properties) í˜¸ì¶œ
      â””â”€ notion.pages.update() ì‹¤í–‰

4. Notion API
   â””â”€ í˜ì´ì§€ ì—…ë°ì´íŠ¸ ì™„ë£Œ

5. í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ
   {
     success: true,
     data: { ... }
   }
```

---

## ğŸ“Š ë°ì´í„° íë¦„

### ê°„í¸ ëª¨ë“œ (simplified=true)

**ì…ë ¥:**
```json
{
  "updates": {
    "ì´ë¦„": { "type": "rich_text", "value": "í™ê¸¸ë™" },
    "ë‚˜ì´": { "type": "number", "value": 30 }
  }
}
```

**ë³€í™˜ ê³¼ì •:**
```javascript
// 1. ê°„í¸ í˜•ì‹ì„ Notion í˜•ì‹ìœ¼ë¡œ ë³€í™˜
{
  "ì´ë¦„": {
    "rich_text": [{ "text": { "content": "í™ê¸¸ë™" } }]
  },
  "ë‚˜ì´": {
    "number": 30
  }
}
```

**ì¶œë ¥:**
```json
{
  "success": true,
  "data": {
    "id": "í˜ì´ì§€ID",
    "properties": {
      "ì´ë¦„": "í™ê¸¸ë™",
      "ë‚˜ì´": 30
    }
  }
}
```

### ì „ë¬¸ ëª¨ë“œ (simplified=false)

**ì…ë ¥/ì¶œë ¥ ëª¨ë‘ Notion ì›ë³¸ í˜•ì‹:**
```json
{
  "properties": {
    "ì´ë¦„": {
      "rich_text": [{ "text": { "content": "í™ê¸¸ë™" } }]
    }
  }
}
```

---

## ğŸš€ ì„œë²„ ì‹œì‘ í”„ë¡œì„¸ìŠ¤

```
1. server.js ì‹¤í–‰
   â”œâ”€ dotenv.config() - í™˜ê²½ë³€ìˆ˜ ë¡œë“œ
   â”œâ”€ app.js ì„í¬íŠ¸
   â””â”€ ì„œë²„ ë¦¬ìŠ¤ë„ˆ ì‹œì‘

2. app.js ì´ˆê¸°í™”
   â”œâ”€ Express ì•± ìƒì„±
   â”œâ”€ ë¯¸ë“¤ì›¨ì–´ ì„¤ì •
   â”‚  â”œâ”€ CORS
   â”‚  â”œâ”€ JSON Parser
   â”‚  â””â”€ Morgan (HTTP ë¡œê¹…)
   â”œâ”€ ë¼ìš°í„° ë“±ë¡
   â”‚  â”œâ”€ /api/products
   â”‚  â”œâ”€ /api/customers
   â”‚  â””â”€ ... (11ê°œ ë¼ìš°í„°)
   â””â”€ ì—ëŸ¬ í•¸ë“¤ëŸ¬ ë“±ë¡

3. ë°ì´í„°ë² ì´ìŠ¤ ID ê²€ì¦
   â”œâ”€ validateDatabaseIds() ì‹¤í–‰
   â””â”€ ëª¨ë“  DB ID í™•ì¸

4. ì„œë²„ ì‹œì‘ ì™„ë£Œ
   â””â”€ í¬íŠ¸ ë¦¬ìŠ¤ë‹ ì‹œì‘
```

### ì„œë²„ ì‹œì‘ ë¡œê·¸ ì˜ˆì‹œ
```
ğŸš€ ì„œë²„ê°€ í¬íŠ¸ 3000ì—ì„œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.
ğŸ“¦ í™˜ê²½: development
ğŸŒ URL: http://localhost:3000
âœ… ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ IDê°€ ì •ìƒì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.

ğŸ“š ì‚¬ìš© ê°€ëŠ¥í•œ ì—”ë“œí¬ì¸íŠ¸:
   - /api/products           (ìƒí’ˆë°ì´í„°)
   - /api/customers          (êµ¬ë§¤ìë°ì´í„°)
   ...
```

---

## âš ï¸ ì—ëŸ¬ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤

### ì—ëŸ¬ ì²˜ë¦¬ ê³„ì¸µ

```
1. Notion API ì—ëŸ¬
   â”œâ”€ object_not_found
   â”‚  â””â”€ ë°ì´í„°ë² ì´ìŠ¤ ID ì˜¤ë¥˜ ë˜ëŠ” Integration ë¯¸ì—°ê²°
   â”œâ”€ validation_error
   â”‚  â””â”€ properties í˜•ì‹ ì˜¤ë¥˜
   â””â”€ rate_limit
      â””â”€ API í˜¸ì¶œ ì œí•œ ì´ˆê³¼

2. Generic Service ì—ëŸ¬
   â”œâ”€ try-catchë¡œ Notion ì—ëŸ¬ ìº¡ì²˜
   â”œâ”€ ì—ëŸ¬ ë¡œê¹… (logger.error)
   â””â”€ í‘œì¤€í™”ëœ ì—ëŸ¬ ê°ì²´ ë°˜í™˜
      {
        success: false,
        error: "ì—ëŸ¬ ë©”ì‹œì§€",
        code: "ERROR_CODE"
      }

3. Express ë¼ìš°í„° ì—ëŸ¬
   â”œâ”€ Service ì—ëŸ¬ ìº¡ì²˜
   â”œâ”€ HTTP ìƒíƒœ ì½”ë“œ ì„¤ì •
   â””â”€ í´ë¼ì´ì–¸íŠ¸ ì‘ë‹µ

4. Express ì—ëŸ¬ í•¸ë“¤ëŸ¬
   â”œâ”€ ì²˜ë¦¬ë˜ì§€ ì•Šì€ ì—ëŸ¬ ìº¡ì²˜
   â”œâ”€ 500 ì—ëŸ¬ ì‘ë‹µ
   â””â”€ ê°œë°œ ëª¨ë“œì—ì„œë§Œ ìƒì„¸ ì—ëŸ¬ í‘œì‹œ
```

### ì—ëŸ¬ ì‘ë‹µ í˜•ì‹

```json
{
  "success": false,
  "error": "ë°ì´í„°ë² ì´ìŠ¤ ì¡°íšŒ ì‹¤íŒ¨: object_not_found",
  "code": "DATABASE_QUERY_ERROR"
}
```

---

## ğŸ”§ ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ì„¤ëª…

### 1. Generic Service (`src/services/genericService.js`)

**ì—­í• **: ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ì— ê³µí†µìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” CRUD ë¡œì§ ì œê³µ

**ì£¼ìš” ë©”ì„œë“œ:**
- `getAllItems(filters, sorts)`: ì „ì²´ ì¡°íšŒ
- `getItem(pageId)`: ë‹¨ì¼ ì¡°íšŒ
- `addItem(properties)`: í•­ëª© ì¶”ê°€
- `updateItem(pageId, properties)`: í•­ëª© ìˆ˜ì •
- `deleteItem(pageId)`: í•­ëª© ì‚­ì œ (ì•„ì¹´ì´ë¸Œ)
- `analyzeSchema()`: ìŠ¤í‚¤ë§ˆ ë¶„ì„
- `validateProperties(properties)`: ë°ì´í„° ê²€ì¦

### 2. ë¼ìš°í„° (`src/routes/*.js`)

**ì—­í• **: HTTP ìš”ì²­ì„ ë°›ì•„ Serviceë¥¼ í˜¸ì¶œí•˜ê³  ì‘ë‹µ ë°˜í™˜

**ê³µí†µ ê¸°ëŠ¥:**
- Properties ê°„í¸ ëª¨ë“œ ë³€í™˜
- ì—ëŸ¬ í•¸ë“¤ë§
- ë¡œê¹…

### 3. Notion Client (`src/config/notionClient.js`)

**ì—­í• **: Notion API í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™” ë° ë°ì´í„°ë² ì´ìŠ¤ ID ê´€ë¦¬

---

## ğŸ“ í”„ë¡œì„¸ìŠ¤ ì²´í¬ë¦¬ìŠ¤íŠ¸

### ê°œë°œì ì‘ì—… íë¦„

1. **í™˜ê²½ ì„¤ì •**
   - [ ] `.env` íŒŒì¼ ìƒì„±
   - [ ] Notion API Key ì„¤ì •
   - [ ] ë°ì´í„°ë² ì´ìŠ¤ ID ì„¤ì •
   - [ ] Integration ì—°ê²°

2. **ì„œë²„ ì‹¤í–‰**
   - [ ] `npm install` ì‹¤í–‰
   - [ ] `npm run dev` ì‹¤í–‰
   - [ ] ì„œë²„ ì‹œì‘ í™•ì¸

3. **API í…ŒìŠ¤íŠ¸**
   - [ ] `/health` ì—”ë“œí¬ì¸íŠ¸ í™•ì¸
   - [ ] `/api/{endpoint}/list` í…ŒìŠ¤íŠ¸
   - [ ] ê°„í¸ ëª¨ë“œ í…ŒìŠ¤íŠ¸
   - [ ] ì „ë¬¸ ëª¨ë“œ í…ŒìŠ¤íŠ¸

4. **ë°°í¬**
   - [ ] Docker ì´ë¯¸ì§€ ë¹Œë“œ
   - [ ] Kubernetes ë°°í¬
   - [ ] í—¬ìŠ¤ ì²´í¬ í™•ì¸

---

## ğŸ”— ê´€ë ¨ ë¬¸ì„œ

- [API í†µí•© ê°€ì´ë“œ](../../API_GUIDE.md)
- [í™˜ê²½ ì„¤ì • ê°€ì´ë“œ](./SETUP_ENV.md)
- [ë°°í¬ ê°€ì´ë“œ](./DEPLOYMENT.md)
- [íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ](./TROUBLESHOOTING.md)
- [í”„ë¡œì„¸ìŠ¤ ë¬¸ì„œ ëª©ë¡](./README.md)

---

**ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2024ë…„

